<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>SaslMechanismInformation.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">WildFly Elytron</a> &gt; <a href="../index.html" class="el_bundle">wildfly-elytron-sasl</a> &gt; <a href="index.source.html" class="el_package">org.wildfly.security.sasl.util</a> &gt; <span class="el_source">SaslMechanismInformation.java</span></div><h1>SaslMechanismInformation.java</h1><pre class="source lang-java linenums">/*
 * JBoss, Home of Professional Open Source.
 * Copyright 2015 Red Hat, Inc., and individual contributors
 * as indicated by the @author tags.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.wildfly.security.sasl.util;

import static java.util.Arrays.asList;
import static java.util.Collections.emptySet;
import static java.util.Collections.singleton;
import static java.util.Collections.unmodifiableSet;

import java.security.Principal;
import java.util.LinkedHashSet;
import java.util.Set;
import java.util.function.Predicate;

import org.wildfly.security.credential.BearerTokenCredential;
import org.wildfly.security.credential.Credential;
import org.wildfly.security.credential.GSSKerberosCredential;
import org.wildfly.security.credential.PasswordCredential;
import org.wildfly.security.credential.X509CertificateChainPublicCredential;
import org.wildfly.security.evidence.AlgorithmEvidence;
import org.wildfly.security.evidence.BearerTokenEvidence;
import org.wildfly.security.evidence.Evidence;
import org.wildfly.security.evidence.PasswordGuessEvidence;
import org.wildfly.security.password.OneWayPassword;
import org.wildfly.security.password.Password;
import org.wildfly.security.password.TwoWayPassword;
import org.wildfly.security.password.interfaces.ClearPassword;
import org.wildfly.security.password.interfaces.DigestPassword;
import org.wildfly.security.password.interfaces.OneTimePassword;
import org.wildfly.security.password.interfaces.ScramDigestPassword;
import org.wildfly.security.credential.X509CertificateChainPrivateCredential;

/**
 * A collection of predicates and other information which can be used to filter SASL mechanisms.
 *
 * @see FilterMechanismSaslClientFactory
 * @see FilterMechanismSaslServerFactory
 * @author &lt;a href=&quot;mailto:david.lloyd@redhat.com&quot;&gt;David M. Lloyd&lt;/a&gt;
 */
<span class="nc" id="L56">public final class SaslMechanismInformation {</span>

    public static final class Names {
        public static final String CRAM_MD5 = &quot;CRAM-MD5&quot;;
        public static final String DIGEST_MD5 = &quot;DIGEST-MD5&quot;;
        public static final String DIGEST_SHA = &quot;DIGEST-SHA&quot;;
        public static final String DIGEST_SHA_256 = &quot;DIGEST-SHA-256&quot;;
        public static final String DIGEST_SHA_384 = &quot;DIGEST-SHA-384&quot;;
        public static final String DIGEST_SHA_512 = &quot;DIGEST-SHA-512&quot;;
        public static final String DIGEST_SHA_512_256 = &quot;DIGEST-SHA-512-256&quot;;
        public static final String SCRAM_SHA_1 = &quot;SCRAM-SHA-1&quot;;
        public static final String SCRAM_SHA_1_PLUS = &quot;SCRAM-SHA-1-PLUS&quot;;
        public static final String SCRAM_SHA_256 = &quot;SCRAM-SHA-256&quot;;
        public static final String SCRAM_SHA_256_PLUS = &quot;SCRAM-SHA-256-PLUS&quot;;
        public static final String SCRAM_SHA_384 = &quot;SCRAM-SHA-384&quot;;
        public static final String SCRAM_SHA_384_PLUS = &quot;SCRAM-SHA-384-PLUS&quot;;
        public static final String SCRAM_SHA_512 = &quot;SCRAM-SHA-512&quot;;
        public static final String SCRAM_SHA_512_PLUS = &quot;SCRAM-SHA-512-PLUS&quot;;
        public static final String IEC_ISO_9798_M_DSA_SHA1 = &quot;9798-M-DSA-SHA1&quot;;
        public static final String IEC_ISO_9798_M_ECDSA_SHA1 = &quot;9798-M-ECDSA-SHA1&quot;;
        public static final String IEC_ISO_9798_M_RSA_SHA1_ENC = &quot;9798-M-RSA-SHA1-ENC&quot;;
        public static final String IEC_ISO_9798_U_DSA_SHA1 = &quot;9798-U-DSA-SHA1&quot;;
        public static final String IEC_ISO_9798_U_ECDSA_SHA1 = &quot;9798-U-ECDSA-SHA1&quot;;
        public static final String IEC_ISO_9798_U_RSA_SHA1_ENC = &quot;9798-U-RSA-SHA1-ENC&quot;;
        public static final String ANONYMOUS = &quot;ANONYMOUS&quot;;
        public static final String EAP_AES128 = &quot;EAP-AES128&quot;;
        public static final String EAP_AES128_PLUS = &quot;EAP-AES128-PLUS&quot;;
        public static final String EXTERNAL = &quot;EXTERNAL&quot;;
        public static final String JBOSS_LOCAL_USER = &quot;JBOSS-LOCAL-USER&quot;;
        public static final String OAUTH_10_A = &quot;OAUTH10A&quot;;
        public static final String OAUTHBEARER = &quot;OAUTHBEARER&quot;;
        public static final String OPENID20 = &quot;OPENID20&quot;;
        public static final String OTP = &quot;OTP&quot;;
        public static final String SAML20 = &quot;SAML20&quot;;
        public static final String SECURID = &quot;SECURID&quot;;
        public static final String PLAIN = &quot;PLAIN&quot;;
        public static final String GS2_KRB5 = &quot;GS2-KRB5&quot;;
        public static final String GS2_KRB5_PLUS = &quot;GS2-KRB5-PLUS&quot;;
        public static final String GSSAPI = &quot;GSSAPI&quot;;

        private Names() {}
    }

<span class="nc" id="L99">    private static final Set&lt;String&gt; MD5_MECHS = nSet(</span>
        Names.CRAM_MD5,
        Names.DIGEST_MD5
    );

<span class="nc" id="L104">    private static final Set&lt;String&gt; SHA_MECHS = nSet(</span>
        Names.DIGEST_SHA,
        Names.SCRAM_SHA_1,
        Names.SCRAM_SHA_1_PLUS
    );

<span class="nc" id="L110">    private static final Set&lt;String&gt; SHA_256_MECHS = nSet(</span>
        Names.DIGEST_SHA_256,
        Names.SCRAM_SHA_256,
        Names.SCRAM_SHA_256_PLUS
    );

<span class="nc" id="L116">    private static final Set&lt;String&gt; SHA_384_MECHS = nSet(</span>
        Names.DIGEST_SHA_384,
        Names.SCRAM_SHA_384,
        Names.SCRAM_SHA_384_PLUS
    );

<span class="nc" id="L122">    private static final Set&lt;String&gt; SHA_512_MECHS = nSet(</span>
        Names.DIGEST_SHA_512,
        Names.SCRAM_SHA_512,
        Names.SCRAM_SHA_512_PLUS
    );

<span class="nc" id="L128">    private static final Set&lt;String&gt; SHA_512_256_MECHS = nSet(</span>
            Names.DIGEST_SHA_512_256
    );

<span class="nc" id="L132">    private static final Set&lt;String&gt; MUTUAL_MECHS = nSet(</span>
        Names.IEC_ISO_9798_M_DSA_SHA1,
        Names.IEC_ISO_9798_M_ECDSA_SHA1,
        Names.IEC_ISO_9798_M_RSA_SHA1_ENC
    );

<span class="nc" id="L138">    private static final Set&lt;String&gt; RECOMMENDED_MECHS = nSet(</span>
        Names.IEC_ISO_9798_M_DSA_SHA1,
        Names.IEC_ISO_9798_M_ECDSA_SHA1,
        Names.IEC_ISO_9798_M_RSA_SHA1_ENC,
        Names.IEC_ISO_9798_U_DSA_SHA1,
        Names.IEC_ISO_9798_U_ECDSA_SHA1,
        Names.IEC_ISO_9798_U_RSA_SHA1_ENC,
        Names.ANONYMOUS,
        Names.EAP_AES128,
        Names.EAP_AES128_PLUS,
        Names.EXTERNAL,
        Names.OAUTH_10_A,
        Names.OAUTHBEARER,
        Names.OPENID20,
        Names.OTP,
        Names.SAML20,
        Names.SECURID
    );

    /**
     * A predicate which is true when the mechanism uses MD5.
     */
<span class="nc" id="L160">    public static final Predicate&lt;String&gt; HASH_MD5 = MD5_MECHS::contains;</span>

    /**
     * A predicate which is true when the mechanism uses SHA.
     */
<span class="nc" id="L165">    public static final Predicate&lt;String&gt; HASH_SHA = SHA_MECHS::contains;</span>

    /**
     * A predicate which is true when the mechanism uses SHA-256.
     */
<span class="nc" id="L170">    public static final Predicate&lt;String&gt; HASH_SHA_256 = SHA_256_MECHS::contains;</span>

    /**
     * A predicate which is true when the mechanism uses SHA-384.
     */
<span class="nc" id="L175">    public static final Predicate&lt;String&gt; HASH_SHA_384 = SHA_384_MECHS::contains;</span>

    /**
     * A predicate which is true when the mechanism uses SHA-512.
     */
<span class="nc" id="L180">    public static final Predicate&lt;String&gt; HASH_SHA_512 = SHA_512_MECHS::contains;</span>

    /**
     * A predicate which is true when the mechanism uses SHA-512/256.
     */
<span class="nc" id="L185">    public static final Predicate&lt;String&gt; HASH_SHA_512_256 = SHA_512_256_MECHS::contains;</span>

    /**
     * A predicate which is true when a GS2-family mechanism is being used.
     */
<span class="nc" id="L190">    public static final Predicate&lt;String&gt; GS2 = name -&gt; name.startsWith(&quot;GS2-&quot;);</span>

    /**
     * A predicate which is true when a SCRAM-family mechanism is being used.
     */
<span class="nc" id="L195">    public static final Predicate&lt;String&gt; SCRAM = name -&gt; name.startsWith(&quot;SCRAM-&quot;);</span>

    /**
     * A predicate which is true when a DIGEST-family mechanism is being used.
     */
<span class="nc" id="L200">    public static final Predicate&lt;String&gt; DIGEST = name -&gt; name.startsWith(&quot;DIGEST-&quot;);</span>

    /**
     * A predicate which is true when a IEC/ISO-9798-family mechanism is being used.
     */
<span class="nc" id="L205">    public static final Predicate&lt;String&gt; IEC_ISO_9798 = name -&gt; name.startsWith(&quot;9798-&quot;);</span>

    /**
     * A predicate which is true when an EAP-family mechanism is being used.
     */
<span class="nc" id="L210">    public static final Predicate&lt;String&gt; EAP = name -&gt; name.startsWith(&quot;EAP-&quot;);</span>

    /**
     * A predicate which is true when the mechanism supports mutual authentication.
     */
<span class="nc" id="L215">    public static final Predicate&lt;String&gt; MUTUAL = ((Predicate&lt;String&gt;) MUTUAL_MECHS::contains).or(SCRAM).or(GS2);</span>

    /**
     * A predicate which is true when a mechanism which uses channel binding is being used.
     */
<span class="nc" id="L220">    public static final Predicate&lt;String&gt; BINDING = name -&gt; name.endsWith(&quot;-PLUS&quot;);</span>

    /**
     * A predicate which is true when the name being tested is a recommended mechanism as of the time of this release.
     */
<span class="nc" id="L225">    public static final Predicate&lt;String&gt; RECOMMENDED = ((Predicate&lt;String&gt;) RECOMMENDED_MECHS::contains).or(GS2).or(SCRAM).and(HASH_MD5.negate());</span>

    // credential type sets

<span class="nc" id="L229">    static final Set&lt;Class&lt;? extends Password&gt;&gt; JUST_ONE_WAY = singleton(OneTimePassword.class);</span>
<span class="nc" id="L230">    static final Set&lt;Class&lt;? extends Password&gt;&gt; JUST_TWO_WAY = singleton(TwoWayPassword.class);</span>
<span class="nc" id="L231">    static final Set&lt;Class&lt;? extends Password&gt;&gt; ONE_WAY_AND_TWO_WAY = nSet(OneWayPassword.class, TwoWayPassword.class);</span>
<span class="nc" id="L232">    static final Set&lt;Class&lt;? extends Password&gt;&gt; DIGEST_AND_TWO_WAY = nSet(DigestPassword.class, TwoWayPassword.class);</span>
<span class="nc" id="L233">    static final Set&lt;Class&lt;? extends Password&gt;&gt; SCRAM_AND_TWO_WAY = nSet(ScramDigestPassword.class, TwoWayPassword.class);</span>

<span class="nc" id="L235">    static final Set&lt;Class&lt;? extends Credential&gt;&gt; JUST_X509 = singleton(X509CertificateChainPrivateCredential.class);</span>
<span class="nc" id="L236">    static final Set&lt;Class&lt;? extends Credential&gt;&gt; X_509_PUBLIC_OR_PRIVATE = nSet(X509CertificateChainPublicCredential.class, X509CertificateChainPrivateCredential.class);</span>
<span class="nc" id="L237">    static final Set&lt;Class&lt;? extends Credential&gt;&gt; JUST_PASSWORD = singleton(PasswordCredential.class);</span>
<span class="nc" id="L238">    static final Set&lt;Class&lt;? extends Credential&gt;&gt; JUST_GSS = singleton(GSSKerberosCredential.class);</span>
<span class="nc" id="L239">    static final Set&lt;Class&lt;? extends Credential&gt;&gt; JUST_BEARER_TOKEN = singleton(BearerTokenCredential.class);</span>

<span class="nc" id="L241">    static final Set&lt;Class&lt;? extends Evidence&gt;&gt; JUST_PASSWORD_EVIDENCE = singleton(PasswordGuessEvidence.class);</span>

<span class="nc" id="L243">    static final Set&lt;Class&lt;? extends Evidence&gt;&gt; JUST_BEARER_TOKEN_EVIDENCE = singleton(BearerTokenEvidence.class);</span>

    // algorithm name sets

<span class="nc" id="L247">    static final Set&lt;String&gt; DIGEST_MD5_AND_PLAIN = nSet(DigestPassword.ALGORITHM_DIGEST_MD5, ClearPassword.ALGORITHM_CLEAR);</span>
<span class="nc" id="L248">    static final Set&lt;String&gt; DIGEST_SHA_AND_PLAIN = nSet(DigestPassword.ALGORITHM_DIGEST_SHA, ClearPassword.ALGORITHM_CLEAR);</span>
<span class="nc" id="L249">    static final Set&lt;String&gt; DIGEST_SHA_256_AND_PLAIN = nSet(DigestPassword.ALGORITHM_DIGEST_SHA_256, ClearPassword.ALGORITHM_CLEAR);</span>
<span class="nc" id="L250">    static final Set&lt;String&gt; DIGEST_SHA_384_AND_PLAIN = nSet(DigestPassword.ALGORITHM_DIGEST_SHA_384, ClearPassword.ALGORITHM_CLEAR);</span>
<span class="nc" id="L251">    static final Set&lt;String&gt; DIGEST_SHA_512_AND_PLAIN = nSet(DigestPassword.ALGORITHM_DIGEST_SHA_512, ClearPassword.ALGORITHM_CLEAR);</span>
<span class="nc" id="L252">    static final Set&lt;String&gt; DIGEST_SHA_512_256_AND_PLAIN = nSet(DigestPassword.ALGORITHM_DIGEST_SHA_512_256, ClearPassword.ALGORITHM_CLEAR);</span>
<span class="nc" id="L253">    static final Set&lt;String&gt; SCRAM_SHA_1_AND_PLAIN = nSet(ScramDigestPassword.ALGORITHM_SCRAM_SHA_1, ClearPassword.ALGORITHM_CLEAR);</span>
<span class="nc" id="L254">    static final Set&lt;String&gt; SCRAM_SHA_256_AND_PLAIN = nSet(ScramDigestPassword.ALGORITHM_SCRAM_SHA_256, ClearPassword.ALGORITHM_CLEAR);</span>
<span class="nc" id="L255">    static final Set&lt;String&gt; SCRAM_SHA_384_AND_PLAIN = nSet(ScramDigestPassword.ALGORITHM_SCRAM_SHA_384, ClearPassword.ALGORITHM_CLEAR);</span>
<span class="nc" id="L256">    static final Set&lt;String&gt; SCRAM_SHA_512_AND_PLAIN = nSet(ScramDigestPassword.ALGORITHM_SCRAM_SHA_512, ClearPassword.ALGORITHM_CLEAR);</span>
<span class="nc" id="L257">    static final Set&lt;String&gt; OTP_ALGORITHMS = nSet(OneTimePassword.ALGORITHM_OTP_MD5, OneTimePassword.ALGORITHM_OTP_SHA1,</span>
            OneTimePassword.ALGORITHM_OTP_SHA_256, OneTimePassword.ALGORITHM_OTP_SHA_384,
            OneTimePassword.ALGORITHM_OTP_SHA_512);
<span class="nc" id="L260">    static final Set&lt;String&gt; JUST_PLAIN = singleton(ClearPassword.ALGORITHM_CLEAR);</span>
<span class="nc" id="L261">    static final Set&lt;String&gt; JUST_DSA = singleton(&quot;DSA&quot;);</span>
<span class="nc" id="L262">    static final Set&lt;String&gt; JUST_EC = singleton(&quot;EC&quot;);</span>
<span class="nc" id="L263">    static final Set&lt;String&gt; JUST_RSA = singleton(&quot;RSA&quot;);</span>
<span class="nc" id="L264">    static final Set&lt;String&gt; ALL_ALGORITHMS = singleton(&quot;*&quot;);</span>

    /**
     * Get the supported credential types for the given SASL client mechanism.  If an empty set is returned, then no
     * credentials are used by the mechanism or the mechanism is not known.
     *
     * @param mechName the mechanism name
     * @return the set of allowed client credentials
     */
    public static Set&lt;Class&lt;? extends Credential&gt;&gt; getSupportedClientCredentialTypes(String mechName) {
<span class="nc bnc" id="L274" title="All 6 branches missed.">        switch (mechName) {</span>
            case Names.EXTERNAL:
            case Names.ANONYMOUS: {
<span class="nc" id="L277">                return emptySet();</span>
            }
            case Names.PLAIN:
            case Names.OTP:
            case Names.CRAM_MD5:
            case Names.DIGEST_MD5:
            case Names.DIGEST_SHA:
            case Names.DIGEST_SHA_256:
            case Names.DIGEST_SHA_384:
            case Names.DIGEST_SHA_512:
            case Names.DIGEST_SHA_512_256:
            case Names.SCRAM_SHA_1:
            case Names.SCRAM_SHA_1_PLUS:
            case Names.SCRAM_SHA_256:
            case Names.SCRAM_SHA_256_PLUS:
            case Names.SCRAM_SHA_384:
            case Names.SCRAM_SHA_384_PLUS:
            case Names.SCRAM_SHA_512:
            case Names.SCRAM_SHA_512_PLUS: {
<span class="nc" id="L296">                return JUST_PASSWORD;</span>
            }
            case Names.IEC_ISO_9798_M_DSA_SHA1:
            case Names.IEC_ISO_9798_U_DSA_SHA1:
            case Names.IEC_ISO_9798_M_ECDSA_SHA1:
            case Names.IEC_ISO_9798_U_ECDSA_SHA1:
            case Names.IEC_ISO_9798_M_RSA_SHA1_ENC:
            case Names.IEC_ISO_9798_U_RSA_SHA1_ENC: {
<span class="nc" id="L304">                return X_509_PUBLIC_OR_PRIVATE;</span>
            }
            case Names.OAUTHBEARER: {
<span class="nc" id="L307">                return JUST_BEARER_TOKEN;</span>
            }
            case Names.GSSAPI: {
<span class="nc" id="L310">                return JUST_GSS;</span>
            }
            default: {
<span class="nc bnc" id="L313" title="All 2 branches missed.">                if (GS2.test(mechName)) {</span>
<span class="nc" id="L314">                    return JUST_GSS;</span>
                }
                // unknown
<span class="nc" id="L317">                return emptySet();</span>
            }
        }
    }

    /**
     * Get the supported password types for the given SASL client mechanism.  If an empty set is returned, then no
     * passwords are used by the mechanism or nothing is known about the mechanism.
     *
     * @param mechName the mechanism name
     * @return the set of allowed client password types
     */
    public static Set&lt;Class&lt;? extends Password&gt;&gt; getSupportedClientPasswordTypes(String mechName) {
<span class="nc bnc" id="L330" title="All 6 branches missed.">        switch (mechName) {</span>
            case Names.EXTERNAL:
            case Names.ANONYMOUS: {
<span class="nc" id="L333">                return emptySet();</span>
            }
            case Names.PLAIN:
            case Names.OTP:
            case Names.CRAM_MD5: {
<span class="nc" id="L338">                return JUST_TWO_WAY;</span>
            }
            case Names.DIGEST_MD5:
            case Names.DIGEST_SHA:
            case Names.DIGEST_SHA_256:
            case Names.DIGEST_SHA_384:
            case Names.DIGEST_SHA_512:
            case Names.DIGEST_SHA_512_256: {
<span class="nc" id="L346">                return DIGEST_AND_TWO_WAY;</span>
            }
            case Names.SCRAM_SHA_1:
            case Names.SCRAM_SHA_1_PLUS:
            case Names.SCRAM_SHA_256:
            case Names.SCRAM_SHA_256_PLUS:
            case Names.SCRAM_SHA_384:
            case Names.SCRAM_SHA_384_PLUS:
            case Names.SCRAM_SHA_512:
            case Names.SCRAM_SHA_512_PLUS: {
<span class="nc" id="L356">                return SCRAM_AND_TWO_WAY;</span>
            }
            case Names.IEC_ISO_9798_M_DSA_SHA1:
            case Names.IEC_ISO_9798_U_DSA_SHA1:
            case Names.IEC_ISO_9798_M_ECDSA_SHA1:
            case Names.IEC_ISO_9798_U_ECDSA_SHA1:
            case Names.IEC_ISO_9798_M_RSA_SHA1_ENC:
            case Names.IEC_ISO_9798_U_RSA_SHA1_ENC: {
<span class="nc" id="L364">                return emptySet();</span>
            }
            default: {
                // unknown
<span class="nc" id="L368">                return emptySet();</span>
            }
        }
    }

    /**
     * Get the supported credential types for the given SASL server mechanism.  If an empty set is returned, then no
     * credentials are used by the mechanism or the mechanism is unknown.
     *
     * @param mechName the mechanism name
     * @return the set of allowed server credential types
     */
    public static Set&lt;Class&lt;? extends Credential&gt;&gt; getSupportedServerCredentialTypes(String mechName) {
<span class="nc bnc" id="L381" title="All 5 branches missed.">        switch (mechName) {</span>
            case Names.EXTERNAL:
            case Names.ANONYMOUS: {
<span class="nc" id="L384">                return emptySet();</span>
            }
            case Names.PLAIN:
            case Names.OTP:
            case Names.CRAM_MD5:
            case Names.DIGEST_MD5:
            case Names.DIGEST_SHA:
            case Names.DIGEST_SHA_256:
            case Names.DIGEST_SHA_384:
            case Names.DIGEST_SHA_512:
            case Names.DIGEST_SHA_512_256:
            case Names.SCRAM_SHA_1:
            case Names.SCRAM_SHA_1_PLUS:
            case Names.SCRAM_SHA_256:
            case Names.SCRAM_SHA_256_PLUS:
            case Names.SCRAM_SHA_384:
            case Names.SCRAM_SHA_384_PLUS:
            case Names.SCRAM_SHA_512:
            case Names.SCRAM_SHA_512_PLUS: {
<span class="nc" id="L403">                return JUST_PASSWORD;</span>
            }
            case Names.IEC_ISO_9798_M_DSA_SHA1:
            case Names.IEC_ISO_9798_U_DSA_SHA1:
            case Names.IEC_ISO_9798_M_ECDSA_SHA1:
            case Names.IEC_ISO_9798_U_ECDSA_SHA1:
            case Names.IEC_ISO_9798_M_RSA_SHA1_ENC:
            case Names.IEC_ISO_9798_U_RSA_SHA1_ENC: {
                // TODO: look into verification process
<span class="nc" id="L412">                return JUST_X509;</span>
            }
            case Names.GSSAPI: {
<span class="nc" id="L415">                return JUST_GSS;</span>
            }
            default: {
<span class="nc bnc" id="L418" title="All 2 branches missed.">                if (GS2.test(mechName)) {</span>
<span class="nc" id="L419">                    return JUST_GSS;</span>
                }
                // unknown
<span class="nc" id="L422">                return emptySet();</span>
            }
        }
    }

    /**
     * Get the supported password types for the given SASL server mechanism.  If an empty set is returned, then no
     * passwords are used by the mechanism or nothing is known about the mechanism
     *
     * @param mechName the mechanism name
     * @return the set of allowed server password types
     */
    public static Set&lt;Class&lt;? extends Password&gt;&gt; getSupportedServerPasswordTypes(String mechName) {
<span class="nc bnc" id="L435" title="All 8 branches missed.">        switch (mechName) {</span>
            case Names.EXTERNAL:
            case Names.ANONYMOUS: {
<span class="nc" id="L438">                return emptySet();</span>
            }
            case Names.PLAIN: {
<span class="nc" id="L441">                return ONE_WAY_AND_TWO_WAY;</span>
            }
            case Names.OTP: {
<span class="nc" id="L444">                return JUST_ONE_WAY;</span>
            }
            case Names.CRAM_MD5: {
<span class="nc" id="L447">                return JUST_TWO_WAY;</span>
            }
            case Names.DIGEST_MD5:
            case Names.DIGEST_SHA:
            case Names.DIGEST_SHA_256:
            case Names.DIGEST_SHA_384:
            case Names.DIGEST_SHA_512: {
<span class="nc" id="L454">                return DIGEST_AND_TWO_WAY;</span>
            }
            case Names.SCRAM_SHA_1:
            case Names.SCRAM_SHA_1_PLUS:
            case Names.SCRAM_SHA_256:
            case Names.SCRAM_SHA_256_PLUS:
            case Names.SCRAM_SHA_384:
            case Names.SCRAM_SHA_384_PLUS:
            case Names.SCRAM_SHA_512:
            case Names.SCRAM_SHA_512_PLUS: {
<span class="nc" id="L464">                return SCRAM_AND_TWO_WAY;</span>
            }
            case Names.IEC_ISO_9798_M_DSA_SHA1:
            case Names.IEC_ISO_9798_U_DSA_SHA1:
            case Names.IEC_ISO_9798_M_ECDSA_SHA1:
            case Names.IEC_ISO_9798_U_ECDSA_SHA1:
            case Names.IEC_ISO_9798_M_RSA_SHA1_ENC:
            case Names.IEC_ISO_9798_U_RSA_SHA1_ENC: {
<span class="nc" id="L472">                return emptySet();</span>
            }
            default: {
                // unknown
<span class="nc" id="L476">                return emptySet();</span>
            }
        }
    }

    /**
     * Get the supported algorithm names for a SASL client mechanism and credential type.  If the mechanism or
     * credential type is not recognized, or if the given credential type does not use algorithms for the
     * given mechanism name, an empty set is returned.  If all algorithms are supported, a set containing the special
     * string {@code &quot;*&quot;} is returned.
     *
     * @param mechName the SASL mechanism name
     * @param credentialType the proposed credential type
     *
     * @return the set of algorithms, or an empty set if all algorithms have unknown support
     */
    public static Set&lt;String&gt; getSupportedClientCredentialAlgorithms(String mechName, Class&lt;? extends Credential&gt; credentialType) {
<span class="nc bnc" id="L493" title="All 15 branches missed.">        switch (mechName) {</span>
            case Names.CRAM_MD5:
            case Names.PLAIN: {
<span class="nc bnc" id="L496" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? JUST_PLAIN : emptySet();</span>
            }
            case Names.DIGEST_MD5: {
<span class="nc bnc" id="L499" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? DIGEST_MD5_AND_PLAIN : emptySet();</span>
            }
            case Names.DIGEST_SHA: {
<span class="nc bnc" id="L502" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? DIGEST_SHA_AND_PLAIN : emptySet();</span>
            }
            case Names.DIGEST_SHA_256: {
<span class="nc bnc" id="L505" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? DIGEST_SHA_256_AND_PLAIN : emptySet();</span>
            }
            case Names.DIGEST_SHA_384: {
<span class="nc bnc" id="L508" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? DIGEST_SHA_384_AND_PLAIN : emptySet();</span>
            }
            case Names.DIGEST_SHA_512: {
<span class="nc bnc" id="L511" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? DIGEST_SHA_512_AND_PLAIN : emptySet();</span>
            }
            case Names.DIGEST_SHA_512_256: {
<span class="nc bnc" id="L514" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? DIGEST_SHA_512_256_AND_PLAIN : emptySet();</span>
            }
            case Names.SCRAM_SHA_1:
            case Names.SCRAM_SHA_1_PLUS: {
<span class="nc bnc" id="L518" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? SCRAM_SHA_1_AND_PLAIN : emptySet();</span>
            }
            case Names.SCRAM_SHA_256:
            case Names.SCRAM_SHA_256_PLUS: {
<span class="nc bnc" id="L522" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? SCRAM_SHA_256_AND_PLAIN : emptySet();</span>
            }
            case Names.SCRAM_SHA_384:
            case Names.SCRAM_SHA_384_PLUS: {
<span class="nc bnc" id="L526" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? SCRAM_SHA_384_AND_PLAIN : emptySet();</span>
            }
            case Names.SCRAM_SHA_512:
            case Names.SCRAM_SHA_512_PLUS: {
<span class="nc bnc" id="L530" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? SCRAM_SHA_512_AND_PLAIN : emptySet();</span>
            }
            case Names.IEC_ISO_9798_M_DSA_SHA1:
            case Names.IEC_ISO_9798_U_DSA_SHA1: {
<span class="nc bnc" id="L534" title="All 2 branches missed.">                return credentialType.isAssignableFrom(X509CertificateChainPrivateCredential.class) ? JUST_DSA : emptySet();</span>
            }
            case Names.IEC_ISO_9798_M_ECDSA_SHA1:
            case Names.IEC_ISO_9798_U_ECDSA_SHA1: {
                // todo: double-check
<span class="nc bnc" id="L539" title="All 2 branches missed.">                return credentialType.isAssignableFrom(X509CertificateChainPrivateCredential.class) ? JUST_EC : emptySet();</span>
            }
            case Names.IEC_ISO_9798_M_RSA_SHA1_ENC:
            case Names.IEC_ISO_9798_U_RSA_SHA1_ENC: {
<span class="nc bnc" id="L543" title="All 2 branches missed.">                return credentialType.isAssignableFrom(X509CertificateChainPrivateCredential.class) ? JUST_RSA : emptySet();</span>
            }
            default:
<span class="nc" id="L546">                return emptySet();</span>
        }
    }

    /**
     * Get the supported algorithm names for a SASL server mechanism and credential type.  If the mechanism or
     * credential type is not recognized, or if the given credential type does not use algorithms for the
     * given mechanism name, an empty set is returned.  If all algorithms are supported, a set containing the special
     * string {@code &quot;*&quot;} is returned.
     *
     * @param mechName the SASL mechanism name
     * @param credentialType the proposed credential type
     *
     * @return the set of algorithms, or an empty set if all algorithms have equal or unknown support
     */
    public static Set&lt;String&gt; getSupportedServerCredentialAlgorithms(String mechName, Class&lt;? extends Credential&gt; credentialType) {
<span class="nc bnc" id="L562" title="All 14 branches missed.">        switch (mechName) {</span>
            case Names.PLAIN: {
<span class="nc" id="L564">                return ALL_ALGORITHMS;</span>
            }
            case Names.DIGEST_MD5: {
<span class="nc bnc" id="L567" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? DIGEST_MD5_AND_PLAIN : emptySet();</span>
            }
            case Names.DIGEST_SHA: {
<span class="nc bnc" id="L570" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? DIGEST_SHA_AND_PLAIN : emptySet();</span>
            }
            case Names.DIGEST_SHA_256: {
<span class="nc bnc" id="L573" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? DIGEST_SHA_256_AND_PLAIN : emptySet();</span>
            }
            case Names.DIGEST_SHA_384: {
<span class="nc bnc" id="L576" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? DIGEST_SHA_384_AND_PLAIN : emptySet();</span>
            }
            case Names.DIGEST_SHA_512: {
<span class="nc bnc" id="L579" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? DIGEST_SHA_512_AND_PLAIN : emptySet();</span>
            }
            case Names.DIGEST_SHA_512_256: {
<span class="nc bnc" id="L582" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? DIGEST_SHA_512_256_AND_PLAIN : emptySet();</span>
            }
            case Names.SCRAM_SHA_1:
            case Names.SCRAM_SHA_1_PLUS: {
<span class="nc bnc" id="L586" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? SCRAM_SHA_1_AND_PLAIN : emptySet();</span>
            }
            case Names.SCRAM_SHA_256:
            case Names.SCRAM_SHA_256_PLUS: {
<span class="nc bnc" id="L590" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? SCRAM_SHA_256_AND_PLAIN : emptySet();</span>
            }
            case Names.SCRAM_SHA_384:
            case Names.SCRAM_SHA_384_PLUS: {
<span class="nc bnc" id="L594" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? SCRAM_SHA_384_AND_PLAIN : emptySet();</span>
            }
            case Names.SCRAM_SHA_512:
            case Names.SCRAM_SHA_512_PLUS: {
<span class="nc bnc" id="L598" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? SCRAM_SHA_512_AND_PLAIN : emptySet();</span>
            }
            case Names.OTP: {
<span class="nc bnc" id="L601" title="All 2 branches missed.">                return credentialType.isAssignableFrom(PasswordCredential.class) ? OTP_ALGORITHMS : emptySet();</span>
            }
            case Names.IEC_ISO_9798_M_DSA_SHA1:
            case Names.IEC_ISO_9798_U_DSA_SHA1:
            case Names.IEC_ISO_9798_M_ECDSA_SHA1:
            case Names.IEC_ISO_9798_U_ECDSA_SHA1:
            case Names.IEC_ISO_9798_M_RSA_SHA1_ENC:
            case Names.IEC_ISO_9798_U_RSA_SHA1_ENC: {
                // TODO: look into verification process
<span class="nc" id="L610">                return emptySet();</span>
            }
            default:
<span class="nc" id="L613">                return emptySet();</span>
        }
    }

    /**
     * Get the supported evidence types for the given SASL server mechanism.  If an empty set is returned, then no
     * evidence is used by the mechanism.
     *
     * @param mechName the mechanism name
     * @return the set of allowed server credential types
     */
    public static Set&lt;Class&lt;? extends Evidence&gt;&gt; getSupportedServerEvidenceTypes(final String mechName) {
<span class="nc bnc" id="L625" title="All 4 branches missed.">        switch (mechName) {</span>
            case Names.OTP:
            case Names.CRAM_MD5:
            case Names.PLAIN:
            case Names.DIGEST_MD5:
            case Names.DIGEST_SHA:
            case Names.DIGEST_SHA_256:
            case Names.DIGEST_SHA_384:
            case Names.DIGEST_SHA_512:
            case Names.DIGEST_SHA_512_256:
            case Names.SCRAM_SHA_1:
            case Names.SCRAM_SHA_1_PLUS:
            case Names.SCRAM_SHA_256:
            case Names.SCRAM_SHA_256_PLUS:
            case Names.SCRAM_SHA_384:
            case Names.SCRAM_SHA_384_PLUS:
            case Names.SCRAM_SHA_512:
            case Names.SCRAM_SHA_512_PLUS: {
<span class="nc" id="L643">                return JUST_PASSWORD_EVIDENCE;</span>
            }
            case Names.IEC_ISO_9798_M_DSA_SHA1:
            case Names.IEC_ISO_9798_U_DSA_SHA1:
            case Names.IEC_ISO_9798_M_ECDSA_SHA1:
            case Names.IEC_ISO_9798_U_ECDSA_SHA1:
            case Names.IEC_ISO_9798_M_RSA_SHA1_ENC:
            case Names.IEC_ISO_9798_U_RSA_SHA1_ENC: {
                // TODO: look into verification process
<span class="nc" id="L652">                return emptySet();</span>
            }
            case Names.OAUTHBEARER: {
<span class="nc" id="L655">                return JUST_BEARER_TOKEN_EVIDENCE;</span>
            }
            default:
<span class="nc" id="L658">                return emptySet();</span>
        }
    }

    /**
     * Get the supported algorithm names for a SASL server mechanism and evidence type.  If the mechanism or
     * evidence type is not recognized, or if the given evidence type does not have an algorithm restriction for the
     * given mechanism name, an empty set is returned.
     *
     * @param mechName the SASL mechanism name
     * @param evidenceType the proposed evidence type
     *
     * @return the set of algorithms, or an empty set if all algorithms have equal or unknown support
     */
    public static Set&lt;String&gt; getSupportedServerEvidenceAlgorithms(final String mechName, final Class&lt;? extends AlgorithmEvidence&gt; evidenceType) {
<span class="nc bnc" id="L673" title="All 2 branches missed.">        switch (mechName) {</span>
            case Names.IEC_ISO_9798_M_DSA_SHA1:
            case Names.IEC_ISO_9798_U_DSA_SHA1:
            case Names.IEC_ISO_9798_M_ECDSA_SHA1:
            case Names.IEC_ISO_9798_U_ECDSA_SHA1:
            case Names.IEC_ISO_9798_M_RSA_SHA1_ENC:
            case Names.IEC_ISO_9798_U_RSA_SHA1_ENC: {
                // TODO: look into verification process
<span class="nc" id="L681">                return emptySet();</span>
            }
            default:
<span class="nc" id="L684">                return emptySet();</span>
        }
    }

    /**
     * Determine whether a mechanism needs server-side credentials in order to authenticate.  This may include credential
     * verification or acquisition, or both.
     *
     * @param mechName the mechanism name
     * @return {@code true} if the mechanism uses credentials, {@code false} otherwise
     */
    public static boolean needsServerCredentials(final String mechName) {
<span class="nc bnc" id="L696" title="All 2 branches missed.">        switch (mechName) {</span>
            case Names.ANONYMOUS:
            case Names.EXTERNAL:
            case Names.JBOSS_LOCAL_USER:
            case Names.GSSAPI:
            case Names.GS2_KRB5:
            case Names.GS2_KRB5_PLUS: {
<span class="nc" id="L703">                return false;</span>
            }
            default: {
<span class="nc" id="L706">                return true;</span>
            }
        }
    }

    /**
     * Determine whether the given mechanism name is known to not use any sort of {@link Principal} for authentication.
     *
     * @param mechName the mechanism name (must not be {@code null})
     * @return {@code true} if the mechanism does not use a principal, {@code false} if it does or it is not known
     */
    public static boolean doesNotUsePrincipal(final String mechName) {
<span class="nc bnc" id="L718" title="All 2 branches missed.">        switch (mechName) {</span>
            case Names.ANONYMOUS:
            case Names.EXTERNAL:
            case Names.GSSAPI:
            case Names.OAUTHBEARER: {
<span class="nc" id="L723">                return true;</span>
            }
            default: {
<span class="nc" id="L726">                return false;</span>
            }
        }
    }

    /**
     * Determine whether a mechanism does not need the client to present credentials.
     *
     * @param mechName the mechanism name
     * @return {@code true} if the mechanism does not require client credentials, {@code false} if it it does or it is not known
     */
    public static boolean doesNotRequireClientCredentials(final String mechName) {
<span class="nc bnc" id="L738" title="All 2 branches missed.">        switch (mechName) {</span>
            case Names.JBOSS_LOCAL_USER:
            case Names.ANONYMOUS:
            case Names.GSSAPI:
            case Names.EXTERNAL: {
<span class="nc" id="L743">                return true;</span>
            }
            default: {
<span class="nc" id="L746">                return false;</span>
            }
        }
    }

    @SafeVarargs
    private static &lt;T&gt; Set&lt;T&gt; nSet(T... values) {
<span class="nc" id="L753">        return unmodifiableSet(new LinkedHashSet&lt;&gt;(asList(values)));</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>